import{c as x}from"./chunk-ZP25FYFI.js";import{j as w,m as I}from"./chunk-CTLRNFRS.js";import{$ as m,X as d,aa as b,k as h,ka as k,za as v}from"./chunk-VB2YUMDK.js";var u=class extends Error{};u.prototype.name="InvalidTokenError";function U(n){return decodeURIComponent(atob(n).replace(/(.)/g,(e,i)=>{let t=i.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function j(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return U(e)}catch{return atob(e)}}function y(n,e){if(typeof n!="string")throw new u("Invalid token specified: must be a string");e||(e={});let i=e.header===!0?0:1,t=n.split(".")[i];if(typeof t!="string")throw new u(`Invalid token specified: missing part #${i+1}`);let o;try{o=j(t)}catch(r){throw new u(`Invalid token specified: invalid base64 for part #${i+1} (${r.message})`)}try{return JSON.parse(o)}catch(r){throw new u(`Invalid token specified: invalid json for part #${i+1} (${r.message})`)}}var C=(()=>{let e=class e{constructor(t,o){this.document=t,this.platformId=o,this.documentIsAccessible=w(this.platformId)}static getCookieRegExp(t){let o=t.replace(/([[\]{}()|=;+?,.*^$\\])/gi,"\\$1");return new RegExp("(?:^"+o+"|;\\s*"+o+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(t){try{return decodeURIComponent(t)}catch{return t}}check(t){return this.documentIsAccessible?(t=encodeURIComponent(t),e.getCookieRegExp(t).test(this.document.cookie)):!1}get(t){if(this.check(t)){t=encodeURIComponent(t);let r=e.getCookieRegExp(t).exec(this.document.cookie);return r?.[1]?e.safeDecodeURIComponent(r[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let t={},o=this.document;return o.cookie&&o.cookie!==""&&o.cookie.split(";").forEach(r=>{let[c,a]=r.split("=");t[e.safeDecodeURIComponent(c.replace(/^ /,""))]=e.safeDecodeURIComponent(a)}),t}set(t,o,r,c,a,l,g,R){if(!this.documentIsAccessible)return;if(typeof r=="number"||r instanceof Date||c||a||l||g){let f={expires:r,path:c,domain:a,secure:l,sameSite:g||"Lax",partitioned:R};this.set(t,o,f);return}let p=encodeURIComponent(t)+"="+encodeURIComponent(o)+";",s=r||{};if(s.expires)if(typeof s.expires=="number"){let f=new Date(new Date().getTime()+s.expires*1e3*60*60*24);p+="expires="+f.toUTCString()+";"}else p+="expires="+s.expires.toUTCString()+";";s.path&&(p+="path="+s.path+";"),s.domain&&(p+="domain="+s.domain+";"),s.secure===!1&&s.sameSite==="None"&&(s.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${t} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),s.secure&&(p+="secure;"),s.sameSite||(s.sameSite="Lax"),p+="sameSite="+s.sameSite+";",s.partitioned&&(p+="Partitioned;"),this.document.cookie=p}delete(t,o,r,c,a="Lax"){if(!this.documentIsAccessible)return;let l=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(t,"",{expires:l,path:o,domain:r,secure:c,sameSite:a})}deleteAll(t,o,r,c="Lax"){if(!this.documentIsAccessible)return;let a=this.getAll();for(let l in a)a.hasOwnProperty(l)&&this.delete(l,t,o,r,c)}};e.\u0275fac=function(o){return new(o||e)(m(k),m(v))},e.\u0275prov=d({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var D=class n{constructor(e,i){this.http=e;this.router=i}cookies=b(C);isLogin=new h(!1);register(e){return this.http.post("https://ecommerce.routemisr.com/api/v1/auth/signup",e)}login(e){return this.http.post("https://ecommerce.routemisr.com/api/v1/auth/signin",e)}forgetPassword(e){return this.http.post("https://ecommerce.routemisr.com/api/v1/auth/forgotPasswords",e)}verifyCode(e){return this.http.post("https://ecommerce.routemisr.com/api/v1/auth/verifyResetCode",e)}resetPassword(e){return this.http.put("https://ecommerce.routemisr.com/api/v1/auth/resetPassword",e)}decodeToken(e){this.cookies.set("token",e);let i=y(e);console.log(i),i&&i.id&&this.isLogin.next(!0)}logOut(){this.isLogin.next(!1),localStorage.removeItem("token"),this.router.navigate(["/login"])}getCookieValue(e,i){if(!e)return null;let t=e.split(";");for(let o of t){let[r,c]=o.trim().split("=");if(r===i)return c||null}return null}static \u0275fac=function(i){return new(i||n)(m(I),m(x))};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})};export{D as a};
